<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ランダム単語クイズ</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; text-align: center; margin: 30px; }
button { padding: 10px 20px; margin: 5px; font-size: 16px; }
#question { font-size: 20px; margin: 20px; word-wrap: break-word; white-space: pre-wrap; max-width: 90%; margin-left:auto; margin-right:auto; }
#answer { font-size: 18px; margin: 20px; color: green; word-wrap: break-word; white-space: pre-wrap; max-width: 90%; margin-left:auto; margin-right:auto; }
textarea { width: 90%; height: 100px; margin: 10px 0; }
</style>
</head>
<body>

<h1>ランダム単語クイズ11</h1>

<textarea id="inputWords" placeholder="ここに英文と和訳を貼り付け（スペースなしでもOK）"></textarea><br>
<button onclick="addWords()">単語を追加</button>
<br>

<div id="question">ここに問題が表示されます</div>
<div id="answer"></div>

<button onclick="showAnswer()">答えを見る</button>
<button onclick="nextQuestion()">次の問題</button>
<button onclick="toggleDirection()">切替 (英→日 / 日→英)</button>

<script>
let wordList = [];
let currentWord = null;
let lastIndex = -1;
let direction = "en2ja";

// 英字かどうか判定（アポストロフィ ’ ' やハイフンも含む）
function isEnglish(char) {
  return /^[A-Za-z’'\-]$/.test(char);
}

// 英文にスペースがない場合、自動で単語間にスペースを入れる
function autoSpaceEnglish(text) {
  if (text.includes(' ')) return text;
  text = text.replace(/([a-z])([A-Z])/g, '$1 $2'); 
  text = text.replace(/([A-Z])([A-Z][a-z])/g, '$1 $2'); 
  text = text.replace(/([a-zA-Z])(\d)/g, '$1 $2'); 
  text = text.replace(/(\d)([a-zA-Z])/g, '$1 $2'); 
  return text;
}

// 単語追加関数
function addWords() {
  let rawText = document.getElementById("inputWords").value.trim();
  if (!rawText) return;

  // 改行・タブのみ削除（空白は保持）
  rawText = rawText.replace(/[\r\n\t]+/g, '');

  let temp = '';
  let en = '', ja = '';
  let mode = null;

  for (let i = 0; i < rawText.length; i++) {
    const c = rawText[i];
    const charIsEnglish = isEnglish(c);

    if (c === ' ') { // 空白はそのまま
      temp += c;
      continue;
    }

    if (mode === null) {
      mode = charIsEnglish ? 'en' : 'ja';
      temp += c;
    } else if (mode === 'en' && charIsEnglish) {
      temp += c;
    } else if (mode === 'en' && !charIsEnglish) {
      en = autoSpaceEnglish(temp);
      temp = c;
      mode = 'ja';
    } else if (mode === 'ja' && !charIsEnglish) {
      temp += c;
    } else if (mode === 'ja' && charIsEnglish) {
      ja = temp;
      temp = c;
      mode = 'en';
    }

    if (en && ja) {
      wordList.push({en, ja});
      en = ''; ja = '';
    }
  }

  if (mode === 'ja' && en && temp) {
    wordList.push({en, ja: temp});
  }

  document.getElementById("inputWords").value = "";
  nextQuestion();
}

// 次の問題表示
function nextQuestion() {
  if (wordList.length === 0) return;

  let index;
  do {
    index = Math.floor(Math.random() * wordList.length);
  } while (index === lastIndex && wordList.length > 1);

  lastIndex = index;
  currentWord = wordList[index];

  document.getElementById("answer").textContent = "";
  document.getElementById("question").textContent =
    direction === "en2ja" ? currentWord.en : currentWord.ja;
}

// 答え表示
function showAnswer() {
  if (!currentWord) return;
  document.getElementById("answer").textContent =
    direction === "en2ja" ? currentWord.ja : currentWord.en;
}

// 英→日 / 日→英 切替
function toggleDirection() {
  direction = direction === "en2ja" ? "ja2en" : "en2ja";
  nextQuestion();
}
</script>

</body>
</html>
